<!DOCTYPE html> 
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>CHANGE TITLE HERE</title>

	<link rel="stylesheet" type="text/css" href="libs/jquery.fullPage.css" />
	<link href=“https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700|Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i” rel=“stylesheet”>

	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>
	<script type="text/javascript" src="libs/scrolloverflow.js"></script>
	<script type="text/javascript" src="libs/jquery.fullPage.js"></script>

	<style type="text/css">
		@import url('https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700|Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i');

/*	    svg { 
			display: block;
			margin-left:auto; 
			margin-right:0;
			margin:auto; 
		}*/
		.intro {
			display: block;
			margin-left: 295px; 
			width: 500px;

		}
		.intro h1 {
			font-family: 'Roboto', sans-serif;
			font-weight: 900;
			font-size: 37px;
			-webkit-margin-after: 0.5em;
		}
		.intro p {
			-webkit-margin-before: 0em;
			color: #303030;
			font-family: 'Libre Baskerville', serif;
			font-size: 14px;
			line-height: 16pt;
		}
		.charts {
			/*display: block;*/
			/*margin-left:auto; */
			/*margin-right:30px;*/
			float: left;
			width: 50%;
		}
		.charts-sub {
			margin-left: 50px;
		}
		.texts {
			float: left;
			width: 50%;
		}
		.texts-sub {
			width: 500px;
			margin-left:auto; 
			margin-right:50px;
			margin-top:100px;
		}
		.texts-sub h1 {
			font-family: 'Roboto', sans-serif;
			font-weight: 900;
			font-size: 35px;
			-webkit-margin-after: 0.5em;
		}
		.texts-sub p {
			-webkit-margin-before: 0em;
			color: #303030;
			font-family: 'Libre Baskerville', serif;
			font-size: 14px;
			line-height: 16pt;
		}

		body {
			background-color: #FCFCFC;
		}

		input[type=range] {
		  -webkit-appearance: none;
		  margin: auto;
		  margin-top: 30px;
		  display: block;
		  width: 350px;
		}
		input[type=range]:focus {
		  outline: none;
		}
		input[type=range]::-webkit-slider-runnable-track {
		  width: 100%;
		  height: 12px;
		  cursor: pointer;
		  animate: 0.2s;
		  box-shadow: none;
		  background: #ededed;
		  border-radius: 12px;
		  border: none;
		}
		input[type=range]::-webkit-slider-thumb {
		  box-shadow: none;
		  border: 2px solid #ededed;
		  height: 20px;
		  width: 20px;
		  border-radius: 20px;
		  background: #ffffff;
		  cursor: pointer;
		  -webkit-appearance: none;
		  margin-top: -5px;
		}
		/*input[type=range]:hover::-webkit-slider-runnable-track {
		  background: #bababa;
		}*/

		.year-label {
			text-align: center; 
			margin-top: 10px;
			font-family: 'Roboto', sans-serif;
			font-size: 20px;
			color: #BABABA;
		}
		.controls {
			width:350px;
		}
	</style>

	<script type="text/javascript" src="libs/d3.v4.min.js"></script>
	<script src="https://d3js.org/d3-selection-multi.v1.min.js"></script>

	<script type="text/javascript">
		$(document).ready(function() {
			$('#fullpage').fullpage({

			});
		});
	</script>

</head>

<body>

	
	<div id="fullpage">
		<div class="section" id="sectionIntro">
			<div class="intro">
				<h1 style="color: #92DCE5">
					Water resources related<br />
					to health and education<br />
					for women and girls in Africa.
				</h1>

				<p>
					The poor access to water supply is a prevalent issue<br />
					in over 850 million people worldwide. Since 1990,<br />
					2.6 billion people have gained access to improved<br />
					drinking water and today, 91% of the world’s population<br />
					drink clean water. Data showes that improved water source<br />
					is linked to health and education for women and girls<br />
					in the Sub-Saharan Africa.
				</p>
			</div>
		</div>

		<div class="section" id="section1">
			<div class="texts">
				<div class="texts-sub">
					<h1 style="color: #8EC949">Fewer women die<br />in childbirth</h1>
					<p>
						The maternal mortality rate has decreased over<br />
						the last ten years, while the improved water source<br />
						has increased. Therefore it is more likely that the<br />
						mother will survive in a childbirth.
					</p>
					<div class="controls">
						<input type="range" min="1" max="1000" id="nSlider1">
						<div class="year-label">
					  		<label for="nSlider1"> 
					  			<span id="nYear-value1">…</span>
					  		</label>
						</div>
					</div>
				</div>
			</div>
			<div class="charts">
				<div class="charts-sub">
					<div id="vizContainer1"></div>
				</div>
			</div>
		</div>

		<div class="section" id="section2">
			<div class="texts">
				<div class="texts-sub">
					<h1 style="color: #2CC4B2">Babies have a higher<br />chance of growing up</h1>
					<p>
						With the improved water source increasing<br />
						in the timespan of ten years, the infant mortality<br />
						rate goes down. This means that there are fewer<br />
						babies under the age of one that dies.
					</p>
					<div class="controls">
						<input type="range" min="1" max="1000" id="nSlider2">
						<div class="year-label">
					  		<label for="nSlider2"> 
					  			<span id="nYear-value2">…</span>
					  		</label>
						</div>
					</div>
				</div>
			</div>
			<div class="charts">
				<div class="charts-sub">
					<div id="vizContainer2"></div>
				</div>
			</div>
		</div>

		<div class="section" id="section3">
			<div class="texts">
				<div class="texts-sub">
					<h1 style="color: #F4AA27">The number of babies<br />born is decreasing</h1>
					<p>
						Data shows that while the improved water source<br />
						increases, the fertility rate is actually decreasing.<br />
						A woman is now more likely to have fewer children,<br />
						than before.
					</p>
					<div class="controls">
						<input type="range" min="1" max="1000" id="nSlider3">
						<div class="year-label">
					  		<label for="nSlider3"> 
					  			<span id="nYear-value3">…</span>
					  		</label>
						</div>
					</div>
				</div>
			</div>
			<div class="charts">
				<div class="charts-sub">
					<div id="vizContainer3"></div>
				</div>
			</div>
		</div>

		<div class="section" id="section4">
			<div class="texts">
				<div class="texts-sub">
					<h1 style="color: #EF5B77">More girls get to<br />complete primary school</h1>
					<p>
						With the improved water source increasing, it is also<br />
						shown that chances are bigger that girls in the<br />
						Sub-Saharan Africa will complete the primary school,<br />
						and not drop out.
					</p>
					<div class="controls">
						<input type="range" min="1" max="1000" id="nSlider4">
						<div class="year-label">
					  		<label for="nSlider4"> 
					  			<span id="nYear-value4">…</span>
					  		</label>
						</div>
					</div>
				</div>
			</div>
			<div class="charts">
				<div class="charts-sub">
					<div id="vizContainer4"></div>
				</div>
			</div>
		</div>

		<div class="section" id="sectionSummary">
			<div class="intro">
				<h1 style="color: #92DCE5">
					Water resources related<br />
					to health and education<br />
					for women and girls in Africa.
				</h1>

				<p>
					The poor access to water supply is a prevalent issue<br />
					in over 850 million people worldwide. Since 1990,<br />
					2.6 billion people have gained access to improved<br />
					drinking water and today, 91% of the world’s population<br />
					drink clean water. Data showes that improved water source<br />
					is linked to health and education for women and girls<br />
					in the Sub-Saharan Africa.
				</p>
			</div>
		</div>
	</div>

	<script type="text/javascript">
		var improvedWaterSourceData;
		var fertilityRateData;
		var infantMortalityData;
		var maternalMortalityData;
		var primaryCompletionData;

		var allData = [];

		var currentVisibleDataAbove1;
		var currentVisibleDataBelow1;
		var currentVisibleDataAbove2;
		var currentVisibleDataBelow2;
		var currentVisibleDataAbove3;
		var currentVisibleDataBelow3;
		var currentVisibleDataAbove4;
		var currentVisibleDataBelow4;

		var width = 500;
		var height = 430;
		var svgCanvas;

		var colors = ["#8EC949", "#2CC4B2", "#F4AA27", "#EF5B77"];

		var legends = [
			"Maternal mortality ratio\n(per 100,000 live births)", 
			"Mortality rate, infant\n(per 1,000 live births)", 
			"Fertility rate, total\n(births per woman)", 
			"Primary completion rate,\nfemale (% of relevant age group)"
		];

		function getCountriesData(data) {
			var countriesData = d3.nest()
			 	.key(function(d) {
			 		return d["Country Code"];
				})
				.rollup(function(d) {
					var dataEntries = d3.map(d[0]).entries();

					var years = d3.map();
					var meta = d3.map();

					for (var i = 0; i < dataEntries.length; i++) {
						if (!isNaN(parseInt(dataEntries[i].key))) {
							if (parseInt(dataEntries[i].key) >= 1990 && parseInt(dataEntries[i].key) <= 2014) {
								if (!isNaN(parseFloat(dataEntries[i].value))) {
									years.set(parseInt(dataEntries[i].key), parseFloat(dataEntries[i].value));
								}
							}
						} else {
							meta.set(dataEntries[i].key, dataEntries[i].value);
						}
					}

					return {
						"years": years,
						"meta": meta
					}
				})
				.map(data);

			return countriesData;
		}

		d3.csv("data/improved_water_source.csv", function(data) {
			improvedWaterSourceData = getCountriesData(data)["$TSS"];

			d3.csv("data/fertility_rate.csv", function(data) {
				fertilityRateData = getCountriesData(data)["$TSS"];

				d3.csv("data/infant_mortality_rate.csv", function(data) {
					infantMortalityData = getCountriesData(data)["$TSS"];
					
					d3.csv("data/maternal_mortality_rate.csv", function(data) {
						maternalMortalityData = getCountriesData(data)["$TSS"];

						d3.csv("data/primary_completion_rate.csv", function(data) {
							primaryCompletionData = getCountriesData(data)["$TSS"];

							console.log(primaryCompletionData);
							
							allData = [
								[maternalMortalityData, improvedWaterSourceData],
								[infantMortalityData, improvedWaterSourceData],
								[fertilityRateData, improvedWaterSourceData],
								[primaryCompletionData, improvedWaterSourceData]
							];

							drawCanvas(1);
							drawCanvas(2);
							drawCanvas(3);
							drawCanvas(4);
						});
					});
				});
			});
		});

		var arcAbove = d3.arc()
				.innerRadius(0)
			    .outerRadius(20)
			    .startAngle(-90 * (Math.PI/180))
			    .endAngle(90 * (Math.PI/180));

		var arcBelow = d3.arc()
				.innerRadius(0)
			    .outerRadius(20)
			    .startAngle(90 * (Math.PI/180))
			    .endAngle(270 * (Math.PI/180));

		function drawCanvas(index) { 
			svgCanvas = d3.select("#vizContainer"+index).append("svg") 
				.attrs({
					width: width,
					height: height
				});

			d3.select("#nSlider"+index).on("input", function() {
	  			update(+this.value, eval("currentVisibleDataAbove" + index), eval("currentVisibleDataBelow" + index), index);
			});

		    svgCanvas.append("path")
		    	.attrs({
		    		d: arcAbove,
		    		transform: "translate(250, 200)",
		    		id: "arc1-" + index,
		    		fill: colors[index-1]
		    	});

		    svgCanvas.append("path")
		    	.attrs({
		    		d: arcBelow,
		    		transform: "translate(250, 220)",
		    		id: "arc2-" + index,
		    		fill: "#92DCE5"
		    	});

		    svgCanvas.append("line")
		    	.attrs({
		    		stroke: colors[index-1],
		    		opacity: 1,
		    		x1: 250,
		    		y1: 199,
		    		x2: 500,
		    		y2: 199
		    	});

		    svgCanvas.append("line")
		    	.attrs({
		    		stroke: "#92DCE5",
		    		opacity: 1,
		    		x1: 0,
		    		y1: 221,
		    		x2: 250,
		    		y2: 221
		    	});

		    svgCanvas.append("text")
		    	.attrs({
		    		x: 500,
		    		y: 187,
		    		"font-size": "30px",
		    		"font-weight": 900,
		    		"font-family": "'Roboto', sans-serif",
		    		"text-anchor": "end",
		    		fill: colors[index-1],
		    		id: "text-above-" + index
		    	});

		    svgCanvas.append("text")
		    	.attrs({
		    		x: 250,
		    		y: 20,
		    		"font-size": "15px",
		    		"font-family": "'Libre Baskerville', serif",
		    		"text-anchor": "middle",
		    		"font-style": "italic",
		    		fill: "#BABABA",
		    		id: "legend-above-" + index
		    	});

		    svgCanvas.append("text")
		    	.attrs({
		    		x: 0,
		    		y: 207,
		    		"font-size": "30px",
		    		"font-weight": 900,
		    		"font-family": "'Roboto', sans-serif",
		    		"text-anchor": "start",
		    		fill: "#92DCE5",
		    		id: "text-below-" + index
		    	})

		    svgCanvas.append("text")
		    	.attrs({
		    		x: 250,
		    		y: 410,
		    		"font-size": "15px",
		    		"font-family": "'Libre Baskerville', serif",
		    		"text-anchor": "middle",
		    		"font-style": "italic",
		    		fill: "#BABABA",
		    		id: "legend-above-" + index
		    	})
		    	.text(function(d) {
		    		return "Improved water source (% of population with access)"
		    	});

		    update(1, allData[index-1][0], allData[index-1][1], index);
		}

		function update(sliderValue, visibleDataAbove, visibleDataBelow, sectionIndex) {
			eval("currentVisibleDataBelow" + sectionIndex + " = visibleDataBelow;");
			eval("currentVisibleDataAbove" + sectionIndex + "= visibleDataAbove;"); 

			var years = visibleDataBelow.years.keys();
			for (var i=0; i < years.length; i++) {
				years[i] = parseInt(years[i]);
			}

			var sliderScale = d3.scaleQuantize()
				.domain([1, 1000])
				.range(years);

			var selectedYear = sliderScale(sliderValue);
			d3.select("#nYear-value" + sectionIndex).text(selectedYear);
			d3.select("#nSlider" + sectionIndex).property("value", sliderValue);

			var minRadius = 20;
			var maxRadius = 150;

			var minAbove = d3.min(visibleDataAbove.years.values());
			var maxAbove = d3.max(visibleDataAbove.years.values());
			var radiusScaleAbove = d3.scaleLinear().domain([minAbove, maxAbove]).range([minRadius, maxRadius]);

			var minBelow = d3.min(visibleDataBelow.years.values());
			var maxBelow = d3.max(visibleDataBelow.years.values());
			var radiusScaleBelow = d3.scaleLinear().domain([minBelow, maxBelow]).range([minRadius, maxRadius]);

			arcAbove.outerRadius(radiusScaleAbove(visibleDataAbove.years["$"+selectedYear]));
			d3.select("#arc1-" + sectionIndex).transition()
				.duration(500)
				.attr("d", arcAbove);
			d3.select("#text-above-" + sectionIndex)
				.text(function(d) {
					return parseInt(visibleDataAbove.years["$"+selectedYear]);
				});
			d3.select("#legend-above-" + sectionIndex)
				.text(function(d) {
					return legends[sectionIndex-1];
				});

			arcBelow.outerRadius(radiusScaleBelow(visibleDataBelow.years["$"+selectedYear]));
			d3.select("#arc2-" + sectionIndex).transition()
				.duration(500)
				.attr("d", arcBelow);
			d3.select("#text-below-" + sectionIndex)
				.text(function(d) {
					return parseInt(visibleDataBelow.years["$"+selectedYear]);
				});
		}
		

	</script>
	
	
</body>
</html>
